<!DOCTYPE html>
<html>
<head>
<!-- Meta line required for IE-->
<!-- <meta http-equiv="X-UA-Compatible" content="IE=edge" /> -->

<!-- Only versions of the renderer starting with "m-" are compatible with web workers" /> -->
<!-- Output is limited to KML and GeoJSON.  Canvas output is not possible in a web worker /> -->
<script src="m-c.js" type="text/javascript" ></script>


 <script type = "text/javascript">
 
//function for formatting KML so it can be rendered properly on the HTML page
function formatKMLForHTML(kml)
{
	var formattedKML = "";
	var tempString = kml;
	
	var index = 0;
	var start = 0;

	index = tempString.indexOf("<");
	while(index >=0)
	{
		tempString = tempString.replace("<","&lt;");
		start = index+1;
		index = tempString.indexOf("<", start);
	}
	index = tempString.indexOf(">");
	while(index >=0)
	{
		tempString = tempString.replace(">","&gt;");
		start = index+1;
		index = tempString.indexOf(">", start);
	}

	formattedKML = tempString;
	
	return formattedKML;
}
//clears text on HTML page
function cleartext()
{
	//alert('clr');
	document.getElementById("contentSpan").innerHTML = "";
	return;
}
//sample render call to web worker
function testRender()
{
    var rendererMP = sec.web.renderer.SECWebRenderer;
    var RS = armyc2.c2sd.renderer.utilities.RendererSettings;

    if (rendererMP !== null) 
    {	
		var formatGeoJSON = 2;
		var formatJSON = 1;
		var formatKML = 0;
		var pixelWidth = 800;
		var pixelHeight = 600;
		
		//change this to format GeoJSON to see the different output.
		//var format = formatGeoJSON;
		var format = formatKML;
		
		//RenderSymbol2D recommended for 2D maps.  
		//ID, Name and Description are optional when using GeoJSON format.


//armyc2.c2sd.renderer.utilities.ErrorLogger.LogMessage("multiPointTesterWebWorker.html","testRender","SECTOR RANGE FAN");
		//SECTOR RANGE FAN EXAMPLE
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		var symbolCode = "GFFPAXS---****X"; //sector range fan
        

        var controlPoints = "66.26700036208742,30.62755038706961";
        var bbox = "66.25,30.627,66.27,30.63";//whole symbol will be calculated

        var scale = 50000.0;
		
        //distance (AM), azimuth (AN), and altitudeDepth (X) can all have multiple values so they are enclosed in brackets.
        var ModifiersTG = armyc2.c2sd.renderer.utilities.ModifiersTG;
        var MilStdAttributes = armyc2.c2sd.renderer.utilities.MilStdAttributes;
		var modifiers = {};//{"AM":[3000,10000],"AN":[315,45]};
        modifiers[ModifiersTG.AM_DISTANCE] = [3000,10000];
        modifiers[ModifiersTG.AN_AZIMUTH] = [315,45];
        modifiers[ModifiersTG.X_ALTITUDE_DEPTH] = [0];
		modifiers[MilStdAttributes.LookAtTag] = true;


		//webworker sector range fan test
		//web worker assumes defaults.  you must pass any relevant overrides like symstd.
		var result;
		var data = {};
		data.id = "ID";
		data.name = "Name";
		data.description = "description";
		data.symbolID = symbolCode;
		data.points = controlPoints;
		data.altMode = "absolute";
		data.scale = scale;
		data.bbox = bbox;
		data.modifiers = modifiers;//{"AM":[3000,10000],"AN":[315,45],"X":[0],"LOOKAT":true};
		data.format = format;
		data.pixelHeight = pixelHeight;
		data.pixelWidth = pixelWidth;
		data.symstd = RS.Symbology_2525C;//1;//1=2525C, 0=2525Bch2 
		
		//create web worker
		var worker = new Worker('MPWorker.js');
		
        //setup callbacks
		worker.onerror = function(error)
		{
            //logs error to console
			armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("MPWorker","postMessage",error);
		};
		worker.onmessage = function(e)
		{
			result = e.data.result;
			document.getElementById("contentSpan").innerHTML += "<br/><br/>Sector Range Fan via Web Worker:   <br/>";

			if(e.data.format === "ERROR")
			{
                document.getElementById("contentSpan").innerHTML += "ERROR:<br/>";
				document.getElementById("contentSpan").innerHTML += result;
			}
			else if(format === formatJSON || format === formatGeoJSON)
			{
				document.getElementById("contentSpan").innerHTML += "JSON Format:<br/>";
				if (result === null || result === "")
					document.getElementById("contentSpan").innerHTML += "json empty";
				else
				{
					document.getElementById("contentSpan").innerHTML += result;
				}
			}
			else// if formatted as KML
			{
				document.getElementById("contentSpan").innerHTML += "KML Format:<br/>";
				
				if (result === null || result === "")
					document.getElementById("contentSpan").innerHTML += "kml empty";
				else
				{
					var formattedKML = "";
                    //the following is just so you can view the KML properly on the html page.
				    //this isn't something you'd normally do.
					formattedKML = formatKMLForHTML(result);
					
					document.getElementById("contentSpan").innerHTML += formattedKML;
				}
			}
			
		};//*/
		
		//send data for render request to web worker
		worker.postMessage(data);

		
    } //end if
}

	</script>
</head>
<body>

    <button type='button' onclick='testRender()'>Test Multipoint</button>
	<button type='button' onclick='cleartext()'>Clear</button>
	
   <span id='contentSpan'/>
   
   
   

</body>

</html>