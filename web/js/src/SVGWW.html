<!DOCTYPE html>
<html>
<head>
<!-- Meta line required for IE-->
<!-- <meta http-equiv="X-UA-Compatible" content="IE=edge" /> -->
<script src="include-mpsp.js" type="text/javascript" ></script>
<!-- <script src="armyc2\c2sd\renderer\utilities\RendererUtilities.js" type="text/javascript" ></script> -->




 <script type = "text/javascript">
 
 var start = null;
 var stop = null;
 
function formatKMLForHTML(kml)
{
	var formattedKML = "";
	var tempString = kml;
	
	var index = 0;
	var start = 0;

	var index = tempString.indexOf("<");
	while(index >=0)
	{
		tempString = tempString.replace("<","&lt;");
		start = index+1;
		index = tempString.indexOf("<", start);
	}
	var index = tempString.indexOf(">");
	while(index >=0)
	{
		tempString = tempString.replace(">","&gt;");
		start = index+1;
		index = tempString.indexOf(">", start);
	}

	formattedKML = tempString;
	
	return formattedKML;
}
function cleartext()
{
	//alert('clr');
	document.getElementById("contentSpan").innerHTML = "";
	return;
}
function getFontInfo(name, size, style){
    _ModifierFontName = name;
    _ModifierFontSize = size;
    if(style !== 'bold' || style !== 'normal')
    {
        _ModifierFontStyle = style;
    }
    else
    {
        _ModifierFontStyle = 'bold';
    }
    _ModifierFont = style + " " + size + "pt " + name;
    
    var measurements = armyc2.c2sd.renderer.utilities.RendererUtilities.measureFont(_ModifierFont);
    return {name: name, size:size, style:style, measurements:measurements};
}
 function populateModifiers()
{
    var modifiers = {};
    
    
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.C_QUANTITY]=10;
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.H_ADDITIONAL_INFO_1] = "H";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.H1_ADDITIONAL_INFO_2] = "H1";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.H2_ADDITIONAL_INFO_3] = "H2";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.X_ALTITUDE_DEPTH] = "X";//X
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.K_COMBAT_EFFECTIVENESS] = "K";//K
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.Q_DIRECTION_OF_MOVEMENT] = "45";//Q

    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.W_DTG_1] = armyc2.c2sd.renderer.utilities.SymbolUtilities.getDateLabel(new Date());//W
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.W1_DTG_2] = armyc2.c2sd.renderer.utilities.SymbolUtilities.getDateLabel(new Date());//W1
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.J_EVALUATION_RATING] = "J";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.M_HIGHER_FORMATION] = "M";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.N_HOSTILE] = "ENY";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.P_IFF_SIF] = "P";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.Y_LOCATION] = "Y";
    
    //if(symbol.getSymbolID().startsWith("G"))
        modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.C_QUANTITY] = "C";
    
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.F_REINFORCED_REDUCED] = "(+)";//"RD";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.L_SIGNATURE_EQUIP] = "!";
    //modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.AA_SPECIAL_C2_HQ] = "AA";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.SCC_SONAR_CLASSIFICATION_CONFIDENCE] = "5";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.G_STAFF_COMMENTS] = "G";
    //symbol.symbolicon A
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.V_EQUIP_TYPE] = "V";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.T_UNIQUE_DESIGNATION_1] = "T";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.T1_UNIQUE_DESIGNATION_2] = "T1";
    modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.Z_SPEED] = "999";//Z
    //*/
    //modifiers[armyc2.c2sd.renderer.utilities.ModifiersUnits.CN_CPOF_NAME_LABEL] = "CPOF'D";//Z
    
    //attributes
    
    //modifiers[armyc2.c2sd.renderer.utilities.MilStdAttributes.LineColor] = "#FF00FF";
    //modifiers[armyc2.c2sd.renderer.utilities.MilStdAttributes.FillColor] = "#00FF00";
    
    //modifiers[armyc2.c2sd.renderer.utilities.MilStdAttributes.TextColor] = "#FF00FF";
    //modifiers[armyc2.c2sd.renderer.utilities.MilStdAttributes.TextBackgroundColor] = "#00FF00";
    
    return modifiers;
}
function speedTest(modifiersOn)
{
    //var rendererMP = document.getElementById("SECRenderApplet");
	//var rendererMP = new sec.web.renderer.SECWebRenderer();
        //var rendererMP = sec.web.renderer.SECWebRenderer;

        //var rendererSPSVG = armyc2.c2sd.renderer.MilStdSVGRenderer;//.Render(symbolID,modifiers);

		var start = Date.now();

		
        var fontInfo = this.getFontInfo("Arial",10,"bold");

armyc2.c2sd.renderer.utilities.ErrorLogger.LogMessage("SVGWW.html","testRender","Unit");
		//UNIT RANGE FAN EXAMPLE

		var symbolCode = "SFGPU-----****X"; //sector range fan

		var modifiers = {"SIZE":40};

        if(modifiersOn)
            modifiers = populateModifiers();
		//webworker sector range fan test
		//web worker assumes defaults.  you must pass any relevant overrides like symstd.
		var json5;
		var data = {};
		data.id = "ID";
		data.symbolID = symbolCode;
		data.modifiers = modifiers;
        data.fontInfo = fontInfo;
	
		
		var worker = new Worker('SPWorker.js');
		
		worker.onerror = function(error)
		{
			armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("SPWorker","postMessage",error);
		};
		worker.onmessage = function(e)
		{
            stop = new Date().getTime();
            var time = stop - start;
            //alert('Render 1k symbols: ' + (time/1000));//*/
            document.getElementById("contentSpan").innerHTML += 'Render 1k symbols: ' + (time/1000);
            
			document.getElementById("contentSpan").innerHTML += "<br/><br/>Unit via Web Worker:   <br/>";

			if(e.data.format == "ERROR")
			{
				document.getElementById("contentSpan").innerHTML += e.data.result;
				if(e.data.stack !== null)
				{
					document.getElementById("contentSpan").innerHTML += ("<br/>at " + e.data.stack);
				}
			}
			else
			{
                cleartext();
                document.getElementById("contentSpan").innerHTML += "<br/>"
                start = new Date().getTime();
                for(var j = 0; j < 1000; j++)
                {
                    var total = "";
                    var svg = e.data[j].svg;
                    total += svg;
                    if(j % 10 === 0)
                        total += "<br/>"
                        
                    document.getElementById("contentSpan").innerHTML += total;
                }
                stop = new Date().getTime();
                time = stop - start;
                //alert('Add 1k symbols to the dom: ' + (time/1000));//*/
                document.getElementById("contentSpan").innerHTML += 'Add 1k symbols to the dom: ' + (time/1000);
                
			}
			
			
		};//*/
		
		//send batch data to web renderer
        var batch = [];
        for(var i = 0; i < 1000; i++)
        {
            batch.push({id:"ID",symbolID:"SFGPU----------",modifiers:modifiers})
        }
        start = new Date().getTime();
		worker.postMessage({fontInfo:fontInfo,batch:batch});
		
 /*
		try
		{
			armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("SPWorker","postMessage",new Error("error test"));
		}
		catch(error)
		{
			armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("SPWorker","postMessage",error);
		}
		
    } //end if//*/
}

function testRender()
{
    //var rendererMP = document.getElementById("SECRenderApplet");
	//var rendererMP = new sec.web.renderer.SECWebRenderer();
        //var rendererMP = sec.web.renderer.SECWebRenderer;

        //var rendererSPSVG = armyc2.c2sd.renderer.MilStdSVGRenderer;//.Render(symbolID,modifiers);

		
        var fontInfo = this.getFontInfo("Arial",10,"bold");

armyc2.c2sd.renderer.utilities.ErrorLogger.LogMessage("SVGWW.html","testRender","Unit");
		//UNIT RANGE FAN EXAMPLE

		var symbolCode = "SFGPU-----****X"; //sector range fan

		var modifiers = {"SIZE":100};

		//webworker sector range fan test
		//web worker assumes defaults.  you must pass any relevant overrides like symstd.
		var json5;
		var data = {};
		data.id = "ID";
		data.symbolID = symbolCode;
		data.modifiers = modifiers;
        data.fontInfo = fontInfo;
	
		
		var worker = new Worker('SPWorker.js');
		
		worker.onerror = function(error)
		{
			armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("SPWorker","postMessage",error);
		};
		worker.onmessage = function(e)
		{
			document.getElementById("contentSpan").innerHTML += "<br/><br/>Unit via Web Worker:   <br/>";

			if(e.data.error)
			{
				document.getElementById("contentSpan").innerHTML += e.data.result;
				if(e.data.stack !== null)
				{
					document.getElementById("contentSpan").innerHTML += ("<br/>at " + e.data.stack);
				}
			}
			else
			{
                var svg = e.data.svg;
                document.getElementById("contentSpan").innerHTML += svg;
			}
			
			
		};//*/
		
		//send data to web renderer
		worker.postMessage(data);
		
 /*
		try
		{
			armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("SPWorker","postMessage",new Error("error test"));
		}
		catch(error)
		{
			armyc2.c2sd.renderer.utilities.ErrorLogger.LogException("SPWorker","postMessage",error);
		}
		
    } //end if//*/
}

	</script>
</head>
<body>

    <button type='button' onclick='testRender()'>Test Single Point SVG</button>
    <button type='button' onclick='speedTest(false)'>Speed test 1k SVG batch</button>
    <button type='button' onclick='speedTest(true)'>Speed test 1k SVG batch with all modifiers</button>
	<button type='button' onclick='cleartext()'>Clear</button>
	
   <span id='contentSpan'/>
   
   
   

</body>

</html>